#include <Block.h>

Block::Block(const Texture& texture, const glm::vec3& position, BlockType type, const glm::vec3& size)
    : m_position(position), m_size(size), m_is_active(true), m_block_type(type)
{
    create_block_mesh(texture);
    setup_mesh();
}

Block::~Block()
{
    if (m_VAO) glDeleteVertexArrays(1, &m_VAO);
    if (m_VBO) glDeleteBuffers(1, &m_VBO);
}

void Block::draw(Shader &shader)
{
    shader.use();

    glm::mat4 model = glm::mat4(1.0f);
    model = glm::translate(model, m_position);
    shader.set_mat4("model", model);

    glBindVertexArray(m_VAO);
    glDrawArrays(GL_TRIANGLES, 0, 36);
}

void Block::set_position(const glm::vec3 &position)
{
    m_position = position;
}

void Block::set_block_type(BlockType block_type)
{
    m_block_type = block_type;
}

void Block::set_active(bool active)
{
    m_is_active = active;
}

bool Block::is_active()
{
    return m_is_active;
}

void Block::setup_mesh()
{
    glGenVertexArrays(1, &m_VAO);
    glGenBuffers(1, &m_VBO);

    glBindVertexArray(m_VAO);

    glBindBuffer(GL_ARRAY_BUFFER, m_VBO);
    glBufferData(GL_ARRAY_BUFFER, vertices.size() * sizeof(Vertex), vertices.data(), GL_STATIC_DRAW);

    glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, sizeof(Vertex), (void*)0);
    glEnableVertexAttribArray(0);

    glVertexAttribPointer(1, 2, GL_FLOAT, GL_FALSE, sizeof(Vertex), (void*)offsetof(Vertex, uv));
    glEnableVertexAttribArray(1);

    glBindVertexArray(0);
}

glm::vec3 Block::get_coords() 
{
    if (this->is_active()) return this->m_position;
    else return glm::vec3(-1.0f, -1.0f, -1.0f);
}

void Block::create_block_mesh(const Texture& texture)
{
    switch (m_block_type)
    {
        case GRASS_BLOCK:
            vertices = {
                {{-0.5f, -0.5f, -0.5f}, {0.0f, 0.5f}},  
                {{ 0.5f,  0.5f, -0.5f}, {0.5f, 1.0f}},    
                {{ 0.5f, -0.5f, -0.5f}, {0.5f, 0.5f}},   
                {{ 0.5f,  0.5f, -0.5f}, {0.5f, 1.0f}},
                {{-0.5f, -0.5f, -0.5f}, {0.0f, 0.5f}},
                {{-0.5f,  0.5f, -0.5f}, {0.0f, 1.0f}},

                {{-0.5f, -0.5f,  0.5f}, {0.0f, 0.5f}},
                {{ 0.5f, -0.5f,  0.5f}, {0.5f, 0.5f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.5f, 1.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.5f, 1.0f}},
                {{-0.5f,  0.5f,  0.5f}, {0.0f, 1.0f}},
                {{-0.5f, -0.5f,  0.5f}, {0.0f, 0.5f}},

                {{-0.5f,  0.5f,  0.5f}, {0.0f, 1.0f}},
                {{-0.5f,  0.5f, -0.5f}, {0.5f, 1.0f}},
                {{-0.5f, -0.5f, -0.5f}, {0.5f, 0.5f}},
                {{-0.5f, -0.5f, -0.5f}, {0.5f, 0.5f}},
                {{-0.5f, -0.5f,  0.5f}, {0.0f, 0.5f}},
                {{-0.5f,  0.5f,  0.5f}, {0.0f, 1.0f}},

                {{ 0.5f,  0.5f,  0.5f}, {0.0f, 1.0f}},
                {{ 0.5f, -0.5f, -0.5f}, {0.5f, 0.5f}},
                {{ 0.5f,  0.5f, -0.5f}, {0.5f, 1.0f}},
                {{ 0.5f, -0.5f, -0.5f}, {0.5f, 0.5f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.0f, 1.0f}},
                {{ 0.5f, -0.5f,  0.5f}, {0.0f, 0.5f}},

                {{-0.5f, -0.5f, -0.5f}, {0.5f, 0.5f}},
                {{ 0.5f, -0.5f, -0.5f}, {1.0f, 0.5f}},
                {{ 0.5f, -0.5f,  0.5f}, {1.0f, 1.0f}},
                {{ 0.5f, -0.5f,  0.5f}, {1.0f, 1.0f}},
                {{-0.5f, -0.5f,  0.5f}, {0.5f, 1.0f}},
                {{-0.5f, -0.5f, -0.5f}, {0.5f, 0.5f}},

                {{-0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.5f, 0.5f}},
                {{ 0.5f,  0.5f, -0.5f}, {0.5f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.5f, 0.5f}},
                {{-0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{-0.5f,  0.5f,  0.5f}, {0.0f, 0.5f}}
            };
            break;
            
        case DIRT_BLOCK:
            vertices = {
                {{-0.5f, -0.5f, -0.5f}, {0.5f, 0.0f}},
                {{ 0.5f,  0.5f, -0.5f}, {1.0f, 0.5f}},
                {{ 0.5f, -0.5f, -0.5f}, {1.0f, 0.0f}},
                {{ 0.5f,  0.5f, -0.5f}, {1.0f, 0.5f}},
                {{-0.5f, -0.5f, -0.5f}, {0.5f, 0.0f}},
                {{-0.5f,  0.5f, -0.5f}, {0.5f, 0.5f}},

                {{-0.5f, -0.5f,  0.5f}, {0.5f, 0.0f}},
                {{ 0.5f, -0.5f,  0.5f}, {1.0f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {1.0f, 0.5f}},
                {{ 0.5f,  0.5f,  0.5f}, {1.0f, 0.5f}},
                {{-0.5f,  0.5f,  0.5f}, {0.5f, 0.5f}},
                {{-0.5f, -0.5f,  0.5f}, {0.5f, 0.0f}},

                {{-0.5f,  0.5f,  0.5f}, {0.5f, 0.5f}},
                {{-0.5f,  0.5f, -0.5f}, {1.0f, 0.5f}},
                {{-0.5f, -0.5f, -0.5f}, {1.0f, 0.0f}},
                {{-0.5f, -0.5f, -0.5f}, {1.0f, 0.0f}},
                {{-0.5f, -0.5f,  0.5f}, {0.5f, 0.0f}},
                {{-0.5f,  0.5f,  0.5f}, {0.5f, 0.5f}},

                {{ 0.5f,  0.5f,  0.5f}, {0.5f, 0.5f}},
                {{ 0.5f, -0.5f, -0.5f}, {1.0f, 0.0f}},
                {{ 0.5f,  0.5f, -0.5f}, {1.0f, 0.5f}},
                {{ 0.5f, -0.5f, -0.5f}, {1.0f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.5f, 0.5f}},
                {{ 0.5f, -0.5f,  0.5f}, {0.5f, 0.0f}},

                {{-0.5f, -0.5f, -0.5f}, {0.5f, 0.0f}},
                {{ 0.5f, -0.5f, -0.5f}, {1.0f, 0.0f}},
                {{ 0.5f, -0.5f,  0.5f}, {1.0f, 0.5f}},
                {{ 0.5f, -0.5f,  0.5f}, {1.0f, 0.5f}},
                {{-0.5f, -0.5f,  0.5f}, {0.5f, 0.5f}},
                {{-0.5f, -0.5f, -0.5f}, {0.5f, 0.0f}},

                {{-0.5f,  0.5f, -0.5f}, {0.5f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {1.0f, 0.5f}},
                {{ 0.5f,  0.5f, -0.5f}, {1.0f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {1.0f, 0.5f}},
                {{-0.5f,  0.5f, -0.5f}, {0.5f, 0.0f}},
                {{-0.5f,  0.5f,  0.5f}, {0.5f, 0.5f}}
            };
            break;
            
        case STONE_BLOCK:
            vertices = {
                {{-0.5f, -0.5f, -0.5f}, {0.5f, 0.5f}},
                {{ 0.5f,  0.5f, -0.5f}, {1.0f, 1.0f}},
                {{ 0.5f, -0.5f, -0.5f}, {1.0f, 0.5f}},
                {{ 0.5f,  0.5f, -0.5f}, {1.0f, 1.0f}},
                {{-0.5f, -0.5f, -0.5f}, {0.5f, 0.5f}},
                {{-0.5f,  0.5f, -0.5f}, {0.5f, 1.0f}},

                {{-0.5f, -0.5f,  0.5f}, {0.5f, 0.5f}},
                {{ 0.5f, -0.5f,  0.5f}, {1.0f, 0.5f}},
                {{ 0.5f,  0.5f,  0.5f}, {1.0f, 1.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {1.0f, 1.0f}},
                {{-0.5f,  0.5f,  0.5f}, {0.5f, 1.0f}},
                {{-0.5f, -0.5f,  0.5f}, {0.5f, 0.5f}},

                {{-0.5f,  0.5f,  0.5f}, {0.5f, 1.0f}},
                {{-0.5f,  0.5f, -0.5f}, {1.0f, 1.0f}},
                {{-0.5f, -0.5f, -0.5f}, {1.0f, 0.5f}},
                {{-0.5f, -0.5f, -0.5f}, {1.0f, 0.5f}},
                {{-0.5f, -0.5f,  0.5f}, {0.5f, 0.5f}},
                {{-0.5f,  0.5f,  0.5f}, {0.5f, 1.0f}},

                {{ 0.5f,  0.5f,  0.5f}, {0.5f, 1.0f}},
                {{ 0.5f, -0.5f, -0.5f}, {1.0f, 0.5f}},
                {{ 0.5f,  0.5f, -0.5f}, {1.0f, 1.0f}},
                {{ 0.5f, -0.5f, -0.5f}, {1.0f, 0.5f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.5f, 1.0f}},
                {{ 0.5f, -0.5f,  0.5f}, {0.5f, 0.5f}},

                {{-0.5f, -0.5f, -0.5f}, {0.5f, 0.5f}},
                {{ 0.5f, -0.5f, -0.5f}, {1.0f, 0.5f}},
                {{ 0.5f, -0.5f,  0.5f}, {1.0f, 1.0f}},
                {{ 0.5f, -0.5f,  0.5f}, {1.0f, 1.0f}},
                {{-0.5f, -0.5f,  0.5f}, {0.5f, 1.0f}},
                {{-0.5f, -0.5f, -0.5f}, {0.5f, 0.5f}},

                {{-0.5f,  0.5f, -0.5f}, {0.5f, 0.5f}},
                {{ 0.5f,  0.5f,  0.5f}, {1.0f, 1.0f}},
                {{ 0.5f,  0.5f, -0.5f}, {1.0f, 0.5f}},
                {{ 0.5f,  0.5f,  0.5f}, {1.0f, 1.0f}},
                {{-0.5f,  0.5f, -0.5f}, {0.5f, 0.5f}},
                {{-0.5f,  0.5f,  0.5f}, {0.5f, 1.0f}}
            };
            break;
            
        case AIR_BLOCK:
            vertices = {
                {{-0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{-0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{-0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},

                {{-0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{-0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{-0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},

                {{-0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{-0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{-0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{-0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{-0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},
                {{-0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},

                {{ 0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},

                {{-0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},
                {{-0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},
                {{-0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},

                {{-0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{-0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{-0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}}
            };
            break;

        default:
            vertices = {
                {{-0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{-0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{-0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},

                {{-0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{-0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{-0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},

                {{-0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{-0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{-0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{-0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{-0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},
                {{-0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},

                {{ 0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},

                {{-0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},
                {{ 0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},
                {{-0.5f, -0.5f,  0.5f}, {0.0f, 0.0f}},
                {{-0.5f, -0.5f, -0.5f}, {0.0f, 0.0f}},

                {{-0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{ 0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}},
                {{-0.5f,  0.5f, -0.5f}, {0.0f, 0.0f}},
                {{-0.5f,  0.5f,  0.5f}, {0.0f, 0.0f}}
            };
            break;
    }
}

